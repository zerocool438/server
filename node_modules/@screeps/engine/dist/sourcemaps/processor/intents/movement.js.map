{"version":3,"sources":["processor/intents/movement.js"],"names":["_","require","utils","driver","getDriver","C","constants","matrix","objects","affectedCnt","roomObjects","roomTerrain","checkObstacleAtXY","x","y","object","roomIsInSafeMode","any","i","type","_id","user","contains","OBSTACLE_OBJECT_TYPES","isPublic","structureType","checkTerrain","TERRAIN_MASK_WALL","calcResourcesWeight","creep","totalCarry","weight","RESOURCES_ALL","forEach","resourceType","body","length","part","CARRY","hits","boost","BOOSTS","capacity","Math","min","CARRY_CAPACITY","exports","init","_roomObjects","_roomTerrain","add","dx","dy","newX","newY","key","push","isTileBusy","check","newMatrix","split","resultingMoveObject","parseInt","rates","map","moveBodyparts","filter","MOVE","rate1","rate2","sort","a","b","removeFromMatrix","obstacle","execute","bulk","roomController","gameTime","move","ceilObjects","fatigueRate","TERRAIN_MASK_SWAMP","road","find","nextDecayTime","ROAD_WEAROUT","update","safeMode","constructionSite","fatigue","size"],"mappings":"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","file":"../../../processor/intents/movement.js","sourceRoot":"/src"}