{"version":3,"sources":["processor/market.js"],"names":["q","require","_","utils","driver","getDriver","C","constants","module","exports","execute","market","gameTime","terminals","bulkObjects","bulkUsers","bulkUsersWrite","bulkTransactions","bulkTransactionsWrite","bulkUsersMoney","bulkUsersResources","bulkMarketOrders","terminalsByRoom","indexBy","executeTransfer","fromTerminal","toTerminal","resourceType","amount","transferFeeTerminal","additionalFields","user","targetResourceTotal","calcResources","freeSpace","Math","max","energyCapacity","min","range","calcRoomsDistance","room","transferCost","calcTerminalEnergyCost","RESOURCE_ENERGY","energy","update","insert","extend","time","sender","undefined","recipient","from","to","filter","i","send","forEach","intent","terminal","cooldownTime","targetRoomName","description","replace","TERMINAL_COOLDOWN","usersById","users","ordersById","orders","terminalDeals","directDeals","intents","userIntents","createOrder","price","totalAmount","contains","RESOURCES_ALL","SUBSCRIPTION_TOKEN","roomName","fee","ceil","MARKET_FEE","money","inc","created","active","type","ORDER_SELL","ORDER_BUY","remainingAmount","date","Date","tick","balance","change","order","changeOrderPrice","orderId","newPrice","oldPrice","_id","extendOrder","addAmount","cancelOrder","_cancelled","deal","push","sort","a","b","orderTerminal","targetTerminal","buyer","seller","targetFreeSpace","dealCost","floor","id","npc","shuffle","userFieldName","marketOrderId","anotherUser","remove","availableResourceAmount","subscriptionTokens","userMoney","isOwner","newAmount","newActive","all","clearMarketIntents"],"mappings":"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","file":"../../processor/market.js","sourceRoot":"/src"}