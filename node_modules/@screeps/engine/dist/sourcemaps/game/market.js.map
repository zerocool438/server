{"version":3,"sources":["game/market.js"],"names":["_","require","utils","driver","getRuntimeDriver","C","constants","util","exports","make","runtimeData","intents","register","ordersCreatedDuringTick","cachedOrders","_incomingTransactions","_outgoingTransactions","_orders","_getOrders","resourceType","contains","RESOURCES_ALL","SUBSCRIPTION_TOKEN","JSON","parse","stringify","market","orders","i","price","calcTransactionCost","wrapFn","amount","roomName1","roomName2","distance","calcRoomsDistance","calcTerminalEnergyCost","getAllOrders","filter","getOrderById","id","all","result","createOrder","type","totalAmount","roomName","ERR_INVALID_ARGS","ORDER_BUY","ORDER_SELL","parseFloat","parseInt","MARKET_FEE","credits","ERR_NOT_ENOUGH_RESOURCES","any","userObjects","room","ERR_NOT_OWNER","size","ERR_FULL","pushByName","OK","cancelOrder","orderId","deal","targetRoomName","order","user","subscriptionTokens","terminal","find","transferCost","RESOURCE_ENERGY","cooldownTime","time","ERR_TIRED","money","changeOrderPrice","newPrice","remainingAmount","extendOrder","addAmount","Object","defineProperties","enumerable","get","incomingTransactions","map","transactions","incoming","transactionId","_id","sender","username","users","undefined","recipient","outgoingTransactions","outgoing","myOrders","indexBy","value"],"mappings":"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","file":"../../game/market.js","sourceRoot":"/src"}