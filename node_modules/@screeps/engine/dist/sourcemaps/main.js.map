{"version":3,"sources":["main.js"],"names":["q","require","_","utils","driver","getDriver","config","lastAccessibleRoomsUpdate","usersLegacyQueue","roomsQueue","usersIvmQueue","loop","resetInterval","startLoopTime","process","hrtime","Date","now","stage","emit","self","setInterval","console","error","queue","resetAll","mainLoopResetInterval","notifyTickStarted","then","getAllUsers","users","all","addMulti","legacy","map","user","_id","toString","ivm","whenAllDone","getAllRooms","rooms","room","commitDbBulk","incrementGameTime","log","gameTime","updateAccessibleRoomsList","notifyRoomsDone","mainLoopCustomStage","catch","isObject","stack","finally","clearInterval","usedTime","setTimeout","Math","max","mainLoopMinDuration","connect","create","data","rejections","getUnhandledReasons","forEach","i","resetUnhandledRejections"],"mappings":"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","file":"../main.js","sourceRoot":"/src"}